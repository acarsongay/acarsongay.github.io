---
layout: default
---
<p>Google Sheets API Quickstart</p>
<!--Add buttons to initiate auth sequence and sign out-->
<button id="authorize-button" style="display: none;">Authorize</button>
<button id="signout-button" style="display: none;">Sign Out</button>
<button id="reload-chatbox-button" style="display: none;">Reload Chatbox</button>

<pre id="chatbox_messages"></pre>

<script type="text/javascript">
  // Client ID and API key from the Developer Console
  var CLIENT_ID = "{{ site.google_client_id }}";
  var API_KEY = "{{ site.google_api_key }}";

  // Array of API discovery doc URLs for APIs used by the quickstart
  var DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];

  // Authorization scopes required by the API; multiple scopes can be
  // included, separated by spaces.
  var SCOPES = "https://www.googleapis.com/auth/spreadsheets.readonly";

  var authorizeButton = document.getElementById('authorize-button');
  var signoutButton = document.getElementById('signout-button');
  var reloadChatBoxButton = document.getElementById('reload-chatbox-button');
  /**
   *  On load, called to load the auth2 library and API client library.
   */
  function handleClientLoad() {
    gapi.load('client:auth2', initClient);
  }

  /**
   *  Initializes the API client library and sets up sign-in state
   *  listeners.
   */
  function initClient() {
    gapi.client.init({
      apiKey: API_KEY,
      clientId: CLIENT_ID,
      discoveryDocs: DISCOVERY_DOCS,
      scope: SCOPES
    }).then(function () {
      // Listen for sign-in state changes.
      gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

      // Handle the initial sign-in state.
      updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
      authorizeButton.onclick = handleAuthClick;
      signoutButton.onclick = handleSignoutClick;
      reloadChatBoxButton.onclick = handleReloadChatBoxClick;
    });
  }

  /**
   *  Called when the signed in status changes, to update the UI
   *  appropriately. After a sign-in, the API is called.
   */
  function updateSigninStatus(isSignedIn) {
    if (isSignedIn) {
      authorizeButton.style.display = 'none';
      signoutButton.style.display = 'block';
      reloadChatBoxButton.style.display = 'block';
      listMajors();
    } else {
      authorizeButton.style.display = 'block';
      signoutButton.style.display = 'none';
      reloadChatBoxButton.style.display = 'none';
    }
  }

  /**
   *  Sign in the user upon button click.
   */
  function handleAuthClick(event) {
    gapi.auth2.getAuthInstance().signIn();
  }

  /**
   *  Sign out the user upon button click.
   */
  function handleSignoutClick(event) {
    gapi.auth2.getAuthInstance().signOut();
  }

  /**
   * Reload chat box
   */
   function handleReloadChatBoxClick(event) {
     chatbox_reload();
   }

   function chatbox_reload() {
    document.getElementById('chatbox_messages').innerHTML = "";
    listMajors();
   }

  /**
   * Append a pre element to the body containing the given message
   * as its text node. Used to display the results of the API call.
   *
   * @param {string} message Text to be placed in pre element.
   */
  function appendPre(message) {
    var pre = document.getElementById('chatbox_messages');
    var textContent = document.createTextNode(message + '\n');
    pre.appendChild(textContent);
  }

  /**
   * Print the names and majors of students in a sample spreadsheet:
   * https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit
   */
  function listMajors() {
    gapi.client.sheets.spreadsheets.values.get({
      spreadsheetId: '{{ site.chatbox_sheet_id }}',
      range: 'A2:C20',
    }).then(function(response) {
      var range = response.result;
      if (range.values.length > 0) {
        appendPre('Name, Major:');
        for (i = 0; i < range.values.length; i++) {
          var row = range.values[i];
          // Print columns A and E, which correspond to indices 0 and 4.
          appendPre(row[0] + '<' + row[1] + '>' + row[2]);
        }
      } else {
        appendPre('No data found.');
      }
    }, function(response) {
      appendPre('Error: ' + response.result.error.message);
    });
  }

</script>

<script async defer src="https://apis.google.com/js/api.js"
  onload="this.onload=function(){};handleClientLoad()"
  onreadystatechange="if (this.readyState === 'complete') this.onload()">
</script>

<script type="text/javascript">
  var submitted=false;
  function chatbox_clear_form_input_and_reload() {
    document.getElementById("chatbox_input_name").value = "";
    document.getElementById("chatbox_input_message").value = "";
    chatbox_reload();
  }
</script>
    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"     
onload="if(submitted) {document.setTimeout(chatbox_clear_form_input_and_reload(), 1000);}"></iframe>
      <form action="https://docs.google.com/forms/d/1ZE66gIU2Qb10MmluYxXOstpgchH-saJpqpxtwbdgyis/formResponse?embedded=true" method="post" target="hidden_iframe" 
onsubmit="submitted=true;">
      <div>
        <label class="chat_post_label" for="entry_1737242977">
          <div dir="auto">Minecraft Name:</div>
        </label>
        <input type="text" name="entry.1737242977" value="" id="entry_1737242977 chatbox_input_name" dir="auto" aria-label="Minecraft Name" title="">

        <label class="chat_post_label" for="entry.1563494232">
          <div dir="auto">Message:</div>
        </label>
        <input id="chatbox_input_message" type="text" name="entry.1563494232" value="" " id="entry_1563494232 chatbox_input_message" dir="auto" aria-label="Message" title="">
      </div>
      <input action="./chat_post.html" type="submit" name="submit" value="Send" id="ss-submit">
  </form>