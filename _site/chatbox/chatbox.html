<!doctype html>
<html>
  <head>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript">
      var spreadsheetURL = "https://spreadsheets.google.com/feeds/cells/1xAbPj6YgOWm2LzgrArirLceLfaJZEJ5D2pbo3WkR_x0/1/public/values?alt=json";
      var spData = null;
      function doData(json) {
          spData = json.feed.entry;
      }
      
      function drawCell(tr, val) {
          var td = $("<td/>");
          tr.append(td);      
          td.append(val);
          return td;
      }
      function drawRow(table, rowData) {
        if (rowData == null) return null;
        if (rowData.length == 0) return null;
        var tr = $("<tr/>");
        table.append(tr);
        for(var c=0; c<rowData.length; c++) {
          drawCell(tr, rowData[c]);
        }
        return tr;
      }
      function drawTable(parent) {
        var table = $("<table/>");
        parent.append(table);
        return table;
      }
      function readData(parent) {
          var data = spData;
          var table = drawTable(parent);
          var rowData = [];
          
          for(var r = 0; r<data.length; r++) {
              var cell = data[r]["gs$cell"];
              var val = cell["$t"];
              if (cell.col == 1) {
                  drawRow(table, rowData);
                  rowData = [];
              }
              rowData.push(val);
          }
          drawRow(table, rowData);
      }
      $(document).ready(function(){
          readData($("#data"));
      });
      function getChatResponses() {
        $.getJSON(spreadsheetURL, function(data){
          spData = data.feed.entry;
        });
      }
    </script>   
    <script src="https://spreadsheets.google.com/feeds/cells/1xAbPj6YgOWm2LzgrArirLceLfaJZEJ5D2pbo3WkR_x0/1/public/values?alt=json-in-script&callback=doData"></script>
    <style type="text/css">
      tbody tr:first-child td {display:none;}

      table {
        background-color: rgba(0,0,0,0.3);
      }
      tr td {color:white;}
      tr td {border:none;}
      tr td:first-child {}
      tr td:nth-child(2)::before { content: "<";}
      tr td:nth-child(2)::after { content: ">";}
      tr td:nth-child(3) {
        width: 50em;}

      .chat_post_label {
        display:inline-block;
      }
      .chat_post_input {
        display:inline-block;
      }
      #chatbox_submit {
        display:inline-block;
      }
    </style>
    <style type="text/css" media="print">
      form {display: none;}
    </style>
  </head>

  <body> 
    <div id="chatbox">
      <div id="data"></div>
      <div id="chatbox_user_input">
        <script type="text/javascript">
          var submitted=false;
        </script>
        <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" 
                onload="if(submitted) {setTimeout(function(){window.location='./chatbox.html';}, 500);}"></iframe>

        <form action="https://docs.google.com/forms/d/1ZE66gIU2Qb10MmluYxXOstpgchH-saJpqpxtwbdgyis/formResponse?embedded=true" 
              method="post" 
              target="hidden_iframe" 
              onsubmit="submitted=true;">

          <div>
            <label class="chat_post_label" for="entry_1737242977">
              <div dir="auto">Username:</div>
            </label>
            <input class="chat_post_input" type="text" name="entry.1737242977" value="" id="entry_1737242977 my-name" dir="auto" aria-label="Minecraft Name" title="">

            <label class="chat_post_label" for="entry.1563494232">
              <div dir="auto">Message:</div>
            </label>
            <input class="chat_post_input" action="./chat_post.html" type="text" name="entry.1563494232" value="" " id="entry_1563494232 my-message" dir="auto" aria-label="Message" title="">

            <input action="" type="submit" name="submit" value="Send" id="chatbox_submit">

          </div>

        </form>
      </div>
    </div>
  </body>
</html> 
